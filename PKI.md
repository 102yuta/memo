# 公開鍵認証方式について
## 背景
* 公開鍵方式が生まれた背景には、「鍵配送問題がある。」
* 共通鍵方式の鍵配送問題を解決するために、公開鍵方式が考案された。

## 共通鍵認証方式と公開鍵認証方式

### 共通鍵認証

いわゆる普通のパスワード認証。
暗号化と復号化で同じ鍵(=パスワード)を使う。

### 公開鍵認証方式

公開鍵と秘密鍵という２つの鍵を使う

#### 秘密鍵
* 復号化用の鍵。
* 極秘情報。外に漏れてはいけない。
* 秘密鍵から公開鍵を生成することができる。

#### 公開鍵
* 暗号化用の鍵。
* 全世界に配布しても問題ない。
* 公開鍵から秘密鍵を生成することはできない（やればできるが天文学的な時間がかかる）
* X→Yの生成はできるが逆はできないというのは、巨大な素数を乗算した結果を因数分解するのが困難であるという性質を利用している。

* 現実の通信において、公開鍵方式のみで通信を行うことはない。
 * 公開鍵方式は計算負荷が高いため、共通鍵の配送のために使われる。
 * 実際の通信においては、通信開始時に公開鍵方式によって共通鍵が配送され、データの送受信の暗号化・復号化は共通鍵方式で行われる


公開鍵方式には、１．通信の機密保持　２．認証　という２つの役割がある。

#### 通信の機密保持
* 公開鍵で暗号化し、秘密鍵で復号化する。
* 暗号文作成は公開鍵を持っていれば誰でもできる。
* 暗号文を復号できるのは、秘密鍵保持者だけである。

#### 認証の例
##### 例１：SSHにおける本人認証(クライアント証明)
* サーバ管理者が、自分のクライアントＰＣで鍵ペアを作成する。
* 秘密鍵(実体はファイル)はクライアントＰＣ内に保存する
* 公開鍵(実体はファイル)はサーバにアップしてサーバ内に保存する
　
* ①クライアントＰＣが、サーバにログインしようとする
* ②サーバは、「この暗号文を解読してみろ」と、ある文を公開鍵で暗号化してクライアントに送る。

```
（例：平文「本日は晴天なり」　暗号文「＄Ｙ＃Ｕ％＆？Ｔ」
```

* ③クラアントは、秘密鍵を使って暗号文を復号する。

```
「＄Ｙ＃Ｕ％＆？Ｔ」→「本日は晴天なり」
```

* ④サーバは、クライアントから返ってきた平文を、当初用意した平文と比較する。
もし一致すれば、クライアントが秘密鍵を持っていることが証明される。

##### 例２：SSL通信におけるサーバ証明

http://ja.wikipedia.org/wiki/公開鍵証明書

* 公開鍵とその正当な所持者の関係を証明するための仕組み。
* 公開鍵は証明書の中に含まれている。
* X.509という規格がある。
* サーバ証明書を使って、ブラウザが認証を行う
* 認証には、データ認証（改ざん検知）と本人認証がある。
* 本人認証とは、今通信中のサーバが、公開鍵の正当な所持者であることを確認する行為
* データ認証は、md5やsha1によるハッシュ検査
* 身元証明ＮＧなら、ブラウザは警告を出す。ＯＫなら次へ進む。
* クライアントがサーバの公開鍵を使って共通鍵を暗号化して、サーバに送信する
* サーバは秘密鍵を使って共通鍵を復号化する。
* 共通鍵を使ってデータ通信を行う。

### 参考

http://www.machu.jp/diary/20080302.html#p02
